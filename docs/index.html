<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Reza Dastranj">
<meta name="author" content="Martin Kolář">
<meta name="dcterms.date" content="2023-01-03">

<title>LME-ASDRs - Age-Gender-Country-Specific Death Rates Modelling and Forecasting: A Linear Mixed-Effects Model</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">LME-ASDRs</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" rel="" target="" aria-current="page">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools ms-auto">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#abstract" id="toc-abstract" class="nav-link active" data-scroll-target="#abstract">Abstract</a></li>
  <li><a href="#affiliation" id="toc-affiliation" class="nav-link" data-scroll-target="#affiliation">Affiliation</a></li>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages">Load packages</a></li>
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a>
  <ul class="collapse">
  <li><a href="#list-of-dataset-filenames" id="toc-list-of-dataset-filenames" class="nav-link" data-scroll-target="#list-of-dataset-filenames">List of Dataset Filenames</a></li>
  </ul></li>
  <li><a href="#construction-of-asdrs-dataframe-for-training-set" id="toc-construction-of-asdrs-dataframe-for-training-set" class="nav-link" data-scroll-target="#construction-of-asdrs-dataframe-for-training-set">Construction of ASDRs DataFrame for Training Set</a></li>
  <li><a href="#data-visualization" id="toc-data-visualization" class="nav-link" data-scroll-target="#data-visualization">Data Visualization</a>
  <ul class="collapse">
  <li><a href="#plot-of-k_t" id="toc-plot-of-k_t" class="nav-link" data-scroll-target="#plot-of-k_t">Plot of <span class="math inline">\(k_{t}\)</span></a></li>
  <li><a href="#plot-of-k_ct" id="toc-plot-of-k_ct" class="nav-link" data-scroll-target="#plot-of-k_ct">Plot of <span class="math inline">\(k_{ct}\)</span></a></li>
  <li><a href="#violin-plot" id="toc-violin-plot" class="nav-link" data-scroll-target="#violin-plot">Violin Plot</a></li>
  </ul></li>
  <li><a href="#fit-a-linear-mixed-effects-model-using-lmer-function" id="toc-fit-a-linear-mixed-effects-model-using-lmer-function" class="nav-link" data-scroll-target="#fit-a-linear-mixed-effects-model-using-lmer-function">Fit a Linear Mixed-Effects Model Using lmer Function</a>
  <ul class="collapse">
  <li><a href="#check-for-heteroskedasticity-and-assess-normality" id="toc-check-for-heteroskedasticity-and-assess-normality" class="nav-link" data-scroll-target="#check-for-heteroskedasticity-and-assess-normality">Check for Heteroskedasticity and Assess Normality</a></li>
  <li><a href="#refine-the-model" id="toc-refine-the-model" class="nav-link" data-scroll-target="#refine-the-model">Refine the Model</a></li>
  <li><a href="#check-for-heteroskedasticity-and-assess-normality-refined-model" id="toc-check-for-heteroskedasticity-and-assess-normality-refined-model" class="nav-link" data-scroll-target="#check-for-heteroskedasticity-and-assess-normality-refined-model">Check for Heteroskedasticity and Assess Normality (Refined Model)</a></li>
  <li><a href="#backward-stepwise-selection" id="toc-backward-stepwise-selection" class="nav-link" data-scroll-target="#backward-stepwise-selection">Backward Stepwise Selection</a></li>
  <li><a href="#plot-backward-stepwise-selection-results" id="toc-plot-backward-stepwise-selection-results" class="nav-link" data-scroll-target="#plot-backward-stepwise-selection-results">Plot Backward Stepwise Selection Results</a></li>
  <li><a href="#random-effects-means" id="toc-random-effects-means" class="nav-link" data-scroll-target="#random-effects-means">Random Effects Means</a></li>
  <li><a href="#type-iii-analysis-of-variance-anova-for-significance-testing-final-model" id="toc-type-iii-analysis-of-variance-anova-for-significance-testing-final-model" class="nav-link" data-scroll-target="#type-iii-analysis-of-variance-anova-for-significance-testing-final-model">Type III Analysis of Variance (ANOVA) for Significance Testing (Final Model)</a></li>
  <li><a href="#histograms-of-random-effects-for-the-final-lme-model" id="toc-histograms-of-random-effects-for-the-final-lme-model" class="nav-link" data-scroll-target="#histograms-of-random-effects-for-the-final-lme-model">Histograms of Random Effects for the Final LME Model</a></li>
  </ul></li>
  <li><a href="#creation-of-new-dataset-for-the-lme-model-prediction" id="toc-creation-of-new-dataset-for-the-lme-model-prediction" class="nav-link" data-scroll-target="#creation-of-new-dataset-for-the-lme-model-prediction">Creation of New Dataset for the LME Model Prediction</a></li>
  <li><a href="#simulating-parameter-uncertainty" id="toc-simulating-parameter-uncertainty" class="nav-link" data-scroll-target="#simulating-parameter-uncertainty">Simulating Parameter Uncertainty</a></li>
  <li><a href="#evaluating-forecast-accuracy-mean-squared-error-for-lme-model-predictions" id="toc-evaluating-forecast-accuracy-mean-squared-error-for-lme-model-predictions" class="nav-link" data-scroll-target="#evaluating-forecast-accuracy-mean-squared-error-for-lme-model-predictions">Evaluating Forecast Accuracy: Mean Squared Error for LME Model Predictions</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Age-Gender-Country-Specific Death Rates Modelling and Forecasting: A Linear Mixed-Effects Model</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>Reza Dastranj </p>
             <p>Martin Kolář </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="abstract" class="level1">
<h1>Abstract</h1>
<p>A linear mixed-effects (LME) model is proposed for modelling and forecasting single and multi-population age-specific death rates (ASDRs). The innovative approach that we take in this study treats age, the interaction between gender and age, their interactions with predictors, and cohort as fixed effects. Furthermore, we incorporate additional random effects to account for variations in the intercept, predictor coefficients, and cohort effects among different age groups of females and males across various countries. In the single-population case, we will see how the random effects of intercept and slope change over different age groups. We will show that the LME model is identifiable. Using simulating parameter uncertainty in the LME model, we will calculate 95% uncertainty intervals for death rate forecasts. We will use data from the Human Mortality Database (HMD) to illustrate the procedure. We assess the predictive performance of the LME model in comparison to the Lee-Carter (LC) models fitted to individual populations. Additionally, we evaluate the predictive accuracy of the LME model relative to the Li-Lee (LL) model. Our results indicate that the LME model provides a more precise representation of observed mortality rates within the HMD, demonstrates robustness in calibration rate selection, and exhibits superior performance when contrasted with the LC and LL models.</p>
<p>Keywords: Life insurance, Mortality forecasting, Restricted maximum likelihood, Model selection, Random walks with drift.</p>
<p>For more details, refer to the related paper: Age-Gender-Country-Specific Death Rates Modelling and Forecasting: A Linear Mixed-Effects Model:</p>
<p><a href="https://doi.org/10.48550/arXiv.2311.18668" class="uri">https://doi.org/10.48550/arXiv.2311.18668</a></p>
</section>
<section id="affiliation" class="level1">
<h1>Affiliation</h1>
<p>Department of Mathematics and Statistics, Masaryk University, Kotlářská 2, 611 37 Brno, Czech Republic</p>
</section>
<section id="load-packages" class="level1">
<h1>Load packages</h1>
<p>First, load the packages to be used</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)     <span class="co"># Efficient data manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)          <span class="co"># Data manipulation and transformation</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)        <span class="co"># Data visualization</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(HMDHFDplus)     <span class="co"># Human Mortality Database-related functions</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)           <span class="co"># Linear and Nonlinear Mixed Effects Models</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)      <span class="co"># Collection of tidyverse packages</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lme4)           <span class="co"># Linear Mixed-Effects Models</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmerTest)       <span class="co"># P-values for lmer models</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forecast)       <span class="co"># Time series forecasting</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)            <span class="co"># Companion to Applied Regression</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(merTools)       <span class="co"># Tools for analyzing mixed-effects regression models</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dataset" class="level1">
<h1>Dataset</h1>
<p>Importing downloaded datasets from the Human Mortality Database (<a href="https://www.mortality.org/">HMD</a>) website</p>
<section id="list-of-dataset-filenames" class="level2">
<h2 class="anchored" data-anchor-id="list-of-dataset-filenames">List of Dataset Filenames</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>mylistmf<span class="ot">&lt;-</span><span class="fu">c</span>(</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AUS.fltper_5x1.txt"</span>,<span class="st">"AUT.fltper_5x1.txt"</span>,<span class="st">"BEL.fltper_5x1.txt"</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BGR.fltper_5x1.txt"</span>,<span class="st">"BLR.fltper_5x1.txt"</span>,<span class="st">"CAN.fltper_5x1.txt"</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHE.fltper_5x1.txt"</span>,<span class="st">"CHL.fltper_5x1.txt"</span>,<span class="st">"CZE.fltper_5x1.txt"</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DEUTE.fltper_5x1.txt"</span>,<span class="st">"DEUTW.fltper_5x1.txt"</span>,<span class="st">"DNK.fltper_5x1.txt"</span>,</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ESP.fltper_5x1.txt"</span>,<span class="st">"EST.fltper_5x1.txt"</span>,<span class="st">"FIN.fltper_5x1.txt"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FRATNP.fltper_5x1.txt"</span>,<span class="st">"GBR_NIR.fltper_5x1.txt"</span>,<span class="st">"GBR_NP.fltper_5x1.txt"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GBR_SCO.fltper_5x1.txt"</span>,<span class="st">"GBRTENW.fltper_5x1.txt"</span>,<span class="st">"GRC.fltper_5x1.txt"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HKG.fltper_5x1.txt"</span>,<span class="st">"HUN.fltper_5x1.txt"</span>,<span class="st">"IRL.fltper_5x1.txt"</span>,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ISL.fltper_5x1.txt"</span>,<span class="st">"ISR.fltper_5x1.txt"</span>,<span class="st">"ITA.fltper_5x1.txt"</span>,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JPN.fltper_5x1.txt"</span>,<span class="st">"LTU.fltper_5x1.txt"</span>,<span class="st">"LUX.fltper_5x1.txt"</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LVA.fltper_5x1.txt"</span>,<span class="st">"NLD.fltper_5x1.txt"</span>,<span class="st">"NOR.fltper_5x1.txt"</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NZL_NM.fltper_5x1.txt"</span>,<span class="st">"POL.fltper_5x1.txt"</span>,<span class="st">"PRT.fltper_5x1.txt"</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RUS.fltper_5x1.txt"</span>,<span class="st">"SVK.fltper_5x1.txt"</span>,<span class="st">"SVN.fltper_5x1.txt"</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SWE.fltper_5x1.txt"</span>,<span class="st">"TWN.fltper_5x1.txt"</span>,<span class="st">"UKR.fltper_5x1.txt"</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"USA.fltper_5x1.txt"</span>,</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"AUS.mltper_5x1.txt"</span>,<span class="st">"AUT.mltper_5x1.txt"</span>,<span class="st">"BEL.mltper_5x1.txt"</span>,</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"BGR.mltper_5x1.txt"</span>,<span class="st">"BLR.mltper_5x1.txt"</span>,<span class="st">"CAN.mltper_5x1.txt"</span>,</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"CHE.mltper_5x1.txt"</span>,<span class="st">"CHL.mltper_5x1.txt"</span>,<span class="st">"CZE.mltper_5x1.txt"</span>,</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DEUTE.mltper_5x1.txt"</span>,<span class="st">"DEUTW.mltper_5x1.txt"</span>,<span class="st">"DNK.mltper_5x1.txt"</span>,</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ESP.mltper_5x1.txt"</span>,<span class="st">"EST.mltper_5x1.txt"</span>,<span class="st">"FIN.mltper_5x1.txt"</span>,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"FRATNP.mltper_5x1.txt"</span>,<span class="st">"GBR_NIR.mltper_5x1.txt"</span>,<span class="st">"GBR_NP.mltper_5x1.txt"</span>,</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GBR_SCO.mltper_5x1.txt"</span>,<span class="st">"GBRTENW.mltper_5x1.txt"</span>,<span class="st">"GRC.mltper_5x1.txt"</span>,</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"HKG.mltper_5x1.txt"</span>,<span class="st">"HUN.mltper_5x1.txt"</span>,<span class="st">"IRL.mltper_5x1.txt"</span>,</span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ISL.mltper_5x1.txt"</span>,<span class="st">"ISR.mltper_5x1.txt"</span>,<span class="st">"ITA.mltper_5x1.txt"</span>,</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"JPN.mltper_5x1.txt"</span>,<span class="st">"LTU.mltper_5x1.txt"</span>,<span class="st">"LUX.mltper_5x1.txt"</span>,</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"LVA.mltper_5x1.txt"</span>,<span class="st">"NLD.mltper_5x1.txt"</span>,<span class="st">"NOR.mltper_5x1.txt"</span>,</span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"NZL_NM.mltper_5x1.txt"</span>,<span class="st">"POL.mltper_5x1.txt"</span>,<span class="st">"PRT.mltper_5x1.txt"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"RUS.mltper_5x1.txt"</span>,<span class="st">"SVK.mltper_5x1.txt"</span>,<span class="st">"SVN.mltper_5x1.txt"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>  <span class="st">"SWE.mltper_5x1.txt"</span>,<span class="st">"TWN.mltper_5x1.txt"</span>,<span class="st">"UKR.mltper_5x1.txt"</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>  <span class="st">"USA.mltper_5x1.txt"</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Importing downloaded datasets of AUT, BEL, CHE, CZE, DNK, SWE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read and preprocess datasets for selected European countries. </span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For each population, a new column 'logmx' is created, representing</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co"># the logarithm of the 'mx' column. Finally, the dataset is filtered</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># to include only the years between 1961 and 2019</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>dat0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">45</span>, <span class="dv">3</span>, <span class="dv">46</span>, <span class="dv">7</span>, <span class="dv">50</span>, <span class="dv">9</span>, <span class="dv">52</span>, <span class="dv">12</span>, <span class="dv">55</span>, <span class="dv">40</span>, <span class="dv">83</span>), <span class="cf">function</span>(i) {</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  data.table<span class="sc">::</span><span class="fu">data.table</span>(HMDHFDplus<span class="sc">::</span><span class="fu">readHMD</span>(mylistmf[i]))[, logmx <span class="sc">:</span><span class="er">=</span> <span class="fu">log</span>(mx)][<span class="dv">1961</span> <span class="sc">&lt;=</span> Year <span class="sc">&amp;</span> Year <span class="sc">&lt;=</span> <span class="dv">2019</span>]</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create matrices (M0) for each population's 'logmx' column. </span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Each matrix is of dimensions 59x24, representing the logmx </span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="co"># values over the years for a specific population.</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>M0 <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat0, <span class="cf">function</span>(x) <span class="fu">matrix</span>(x<span class="sc">$</span>logmx, <span class="dv">59</span>, <span class="dv">24</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine matrices horizontally (column-bind) to form a single matrix (MB0)</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>MB0 <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, M0)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="construction-of-asdrs-dataframe-for-training-set" class="level1">
<h1>Construction of ASDRs DataFrame for Training Set</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset data</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat0, <span class="cf">function</span>(x) x[Year <span class="sc">&lt;=</span> <span class="dv">2010</span>])</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize matrices for training set</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>M <span class="ot">&lt;-</span> <span class="fu">lapply</span>(dat, <span class="cf">function</span>(x) <span class="fu">matrix</span>(x<span class="sc">$</span>logmx, t, <span class="dv">24</span>, <span class="at">byrow =</span> <span class="cn">TRUE</span>))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>MB <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, M)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate row means</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">rowMeans</span>(MB)</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replicate row means</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(l, <span class="at">times =</span> <span class="dv">288</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new vector 'k2' by squaring each element in 'k1'</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">&lt;-</span> k1<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list 'kcList' to store individual elements of kc</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>kcList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through pairs of matrices in M</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">5</span>,<span class="dv">7</span>,<span class="dv">9</span>,<span class="dv">11</span>)) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract matrices corresponding to the pairs</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  matrix1 <span class="ot">&lt;-</span> M[[i]]</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  matrix2 <span class="ot">&lt;-</span> M[[i <span class="sc">+</span> <span class="dv">1</span>]]</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the first 10 columns of each matrix, calculate row means, and replicate them 10 times</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>  result1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rowMeans</span>(<span class="fu">cbind</span>(matrix1[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], matrix2[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])), <span class="at">times =</span> <span class="dv">10</span>)</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the last 14 columns of each matrix, calculate row means, and replicate them 14 times</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>  result2 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">rowMeans</span>(<span class="fu">cbind</span>(matrix1[, <span class="dv">11</span><span class="sc">:</span><span class="dv">24</span>], matrix2[, <span class="dv">11</span><span class="sc">:</span><span class="dv">24</span>])), <span class="at">times =</span> <span class="dv">14</span>)</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Repeat the results 2 times and append to kcList</span></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>  kcList <span class="ot">&lt;-</span> <span class="fu">c</span>(kcList, <span class="fu">rep</span>(<span class="fu">c</span>(result1,result2),<span class="dv">2</span>))</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all elements in kcList into a single vector 'kc1'</span></span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>kc1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(kcList)</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new vector 'kc2' by squaring each element in 'kc1'</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>kc2 <span class="ot">&lt;-</span> kc1<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for training set</span></span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">unique</span>(dat[[<span class="dv">9</span>]]<span class="sc">$</span>Year), <span class="at">times =</span> <span class="dv">288</span>)</span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>age_levels <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="dv">5</span>)))</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="dv">5</span>)), <span class="at">each =</span> t, <span class="at">times =</span> <span class="dv">12</span>)</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>cohort <span class="ot">&lt;-</span> year <span class="sc">-</span> age</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for training set</span></span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>gender_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">rep</span>(gender_levels, <span class="at">each =</span> <span class="dv">24</span> <span class="sc">*</span> t, <span class="at">times =</span> <span class="dv">6</span>)</span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a><span class="co"># Define age groups</span></span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>age_groups <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Group[0,40]"</span>, <span class="st">"Group[45,110]"</span>)</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector representing age groups for each observation</span></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>age_groups <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(age_groups[<span class="dv">1</span>], t <span class="sc">*</span> <span class="dv">10</span>), <span class="fu">rep</span>(age_groups[<span class="dv">2</span>], t <span class="sc">*</span> <span class="dv">14</span>)), <span class="dv">12</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>Country_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AUT"</span>, <span class="st">"BEL"</span>, <span class="st">"CHE"</span>, <span class="st">"CZE"</span>, <span class="st">"DNK"</span>, <span class="st">"SWE"</span>)</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>Country <span class="ot">&lt;-</span> <span class="fu">rep</span>(Country_levels, <span class="at">each =</span> <span class="dv">48</span> <span class="sc">*</span> t)</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results into data frame for training set</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>ASDRs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(k1, k2, kc1, kc2, cohort, <span class="at">y =</span> <span class="fu">as.vector</span>(MB), age, </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>                    gender, Country, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert factors to specified levels</span></span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>ASDRs<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(ASDRs<span class="sc">$</span>age, <span class="at">levels =</span> age_levels)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>ASDRs<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(ASDRs<span class="sc">$</span>gender, <span class="at">levels =</span> gender_levels)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>ASDRs<span class="sc">$</span>Country <span class="ot">&lt;-</span> <span class="fu">factor</span>(ASDRs<span class="sc">$</span>Country, <span class="at">levels =</span> Country_levels)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the structure of the resulting data frame</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span> (ASDRs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   14400 obs. of  9 variables:
 $ k1     : num  -4.25 -4.22 -4.23 -4.26 -4.26 ...
 $ k2     : num  18 17.8 17.9 18.2 18.1 ...
 $ kc1    : num  -6.47 -6.5 -6.5 -6.51 -6.55 ...
 $ kc2    : num  41.8 42.2 42.3 42.3 42.9 ...
 $ cohort : num  1961 1962 1963 1964 1965 ...
 $ y      : num  -3.53 -3.51 -3.57 -3.66 -3.67 ...
 $ age    : Factor w/ 24 levels "0","1","5","10",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ gender : Factor w/ 2 levels "Female","Male": 1 1 1 1 1 1 1 1 1 1 ...
 $ Country: Factor w/ 6 levels "AUT","BEL","CHE",..: 1 1 1 1 1 1 1 1 1 1 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the resulting data frame</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ASDRs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         k1       k2       kc1      kc2 cohort         y age gender Country
1 -4.245925 18.02788 -6.466235 41.81219   1961 -3.525741   0 Female     AUT
2 -4.216007 17.77471 -6.497182 42.21337   1962 -3.511235   0 Female     AUT
3 -4.227902 17.87516 -6.501768 42.27299   1963 -3.567016   0 Female     AUT
4 -4.262577 18.16956 -6.506316 42.33215   1964 -3.663212   0 Female     AUT
5 -4.255166 18.10644 -6.548154 42.87832   1965 -3.670647   0 Female     AUT
6 -4.265926 18.19813 -6.525689 42.58461   1966 -3.713172   0 Female     AUT</code></pre>
</div>
</div>
</section>
<section id="data-visualization" class="level1">
<h1>Data Visualization</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a modified dataset for visualization</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>ASDRsnw <span class="ot">&lt;-</span> ASDRs <span class="sc">%&gt;%</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Age =</span> age) <span class="sc">%&gt;%</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(year)))</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ASDRs (log) for the twelve populations from 1961 to 2010</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ASDRsnw, <span class="fu">aes</span>(year, y, <span class="at">color =</span> Age)) <span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(gender <span class="sc">~</span> Country) <span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span></span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">"ASDR (log)"</span>) <span class="sc">+</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/data-vis-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">ASDRs (log) for the twelve populations 1961−2010</figcaption>
</figure>
</div>
</div>
</div>
<section id="plot-of-k_t" class="level2">
<h2 class="anchored" data-anchor-id="plot-of-k_t">Plot of <span class="math inline">\(k_{t}\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of $k_{t}$ showing the average log ASDRs across 12 populations and all age groups (1961-2010)</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ASDRsnw, <span class="fu">aes</span>(year, y, <span class="at">color =</span> Age)) <span class="sc">+</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> k1), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> k1), <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">linewidth =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"ASDR (log)"</span>) <span class="sc">+</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">5</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/kt-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Plot of <span class="math inline">\(k_{t}\)</span>: Average of log ASDRs across 12 populations and all age groups (1961-2010)</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="plot-of-k_ct" class="level2">
<h2 class="anchored" data-anchor-id="plot-of-k_ct">Plot of <span class="math inline">\(k_{ct}\)</span></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot of $k_{ct}$ showing the log ASDRs for each country in our study (1961 − 2010)</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ASDRsnw, <span class="fu">aes</span>(year, y, <span class="at">color =</span> Age)) <span class="sc">+</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> kc1, <span class="at">color =</span> age_groups), <span class="at">size =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> year, <span class="at">y =</span> kc1, <span class="at">color =</span> age_groups), <span class="at">linewidth =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Group[0,40]"</span> <span class="ot">=</span> <span class="st">"red"</span>, <span class="st">"Group[45,110]"</span> <span class="ot">=</span> <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Year"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"ASDR (log)"</span>) <span class="sc">+</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(<span class="sc">~</span>Country) <span class="sc">+</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>))) <span class="sc">+</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">hjust =</span> <span class="dv">1</span>), <span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/kct-plot-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Plot of <span class="math inline">\(k_{ct}\)</span> for each country in our study (1961 − 2010).</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="violin-plot" class="level2">
<h2 class="anchored" data-anchor-id="violin-plot">Violin Plot</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Violin plots illustrating the distribution and probability density of log mortality rates across the six European countries.</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(ASDRsnw, <span class="fu">aes</span>(<span class="at">x =</span> Country, <span class="at">y =</span> y, <span class="at">fill =</span> Country)) <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_violin</span>() <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">"Country"</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">"Mortality (log)"</span>) <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/violin-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Violin plots illustrating the distribution and probability density of log mortality rates across the six European countries.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="fit-a-linear-mixed-effects-model-using-lmer-function" class="level1">
<h1>Fit a Linear Mixed-Effects Model Using lmer Function</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure the time taken to fit the linear mixed-effects model (m1)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  m1 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>      age <span class="sc">+</span> gender<span class="sc">:</span>age <span class="sc">+</span>        <span class="co"># Fixed effects terms: main effects and interactions</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>      gender<span class="sc">:</span>age<span class="sc">:</span><span class="fu">I</span>(kc1) <span class="sc">+</span>       <span class="co"># Interaction term involving kc1</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>      gender<span class="sc">:</span>age<span class="sc">:</span><span class="fu">I</span>(kc2) <span class="sc">+</span>       <span class="co"># Interaction term involving kc2</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">I</span>(k1) <span class="sc">+</span> <span class="fu">I</span>(k2) <span class="sc">+</span> cohort <span class="sc">+</span>  <span class="co"># k1, k2, and cohort fixed effects terms</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>      (<span class="fu">I</span>(k1) <span class="sc">+</span> <span class="fu">I</span>(k2) <span class="sc">+</span> cohort <span class="sc">|</span> Country<span class="sc">:</span>gender<span class="sc">:</span>age),  <span class="co"># Random effects structure</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">REML =</span> <span class="cn">TRUE</span>,              <span class="co"># Use Restricted Maximum Likelihood estimation</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> ASDRs              <span class="co"># Specify the data</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
  63.60    1.06   94.06 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a summary of the fitted linear mixed-effects model</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m1))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: y ~ age + gender:age + gender:age:I(kc1) + gender:age:I(kc2) +  
    I(k1) + I(k2) + cohort + (I(k1) + I(k2) + cohort | Country:gender:age)
   Data: ASDRs

REML criterion at convergence: -28552.7

Scaled residuals: 
     Min       1Q   Median       3Q      Max 
-11.7346  -0.4092   0.0077   0.4317   6.0333 

Random effects:
 Groups             Name        Variance  Std.Dev. Corr             
 Country:gender:age (Intercept) 6.546e-03 0.08091                   
                    I(k1)       6.734e-03 0.08206   0.02            
                    I(k2)       1.782e-02 0.13351   0.00 -0.06      
                    cohort      2.044e-06 0.00143  -0.04  0.17 -0.99
 Residual                       6.415e-03 0.08009                   
Number of obs: 14400, groups:  Country:gender:age, 288

Fixed effects:
                             Estimate Std. Error         df t value Pr(&gt;|t|)
(Intercept)                 4.911e+01  2.146e+00  2.943e+03  22.883  &lt; 2e-16
age1                       -2.115e+01  2.948e+00  1.337e+04  -7.175 7.63e-13
age5                       -1.957e+01  2.948e+00  1.319e+04  -6.640 3.26e-11
age10                      -4.041e+01  2.948e+00  1.347e+04 -13.709  &lt; 2e-16
age15                      -5.627e+01  2.948e+00  1.329e+04 -19.091  &lt; 2e-16
age20                      -6.506e+01  2.947e+00  1.355e+04 -22.073  &lt; 2e-16
age25                      -5.643e+01  2.947e+00  1.337e+04 -19.146  &lt; 2e-16
age30                      -6.075e+01  2.947e+00  1.358e+04 -20.615  &lt; 2e-16
age35                      -6.031e+01  2.947e+00  1.365e+04 -20.469  &lt; 2e-16
age40                      -6.091e+01  2.946e+00  1.342e+04 -20.674  &lt; 2e-16
age45                      -5.506e+01  2.616e+00  1.329e+04 -21.045  &lt; 2e-16
age50                      -4.949e+01  2.617e+00  1.336e+04 -18.911  &lt; 2e-16
age55                      -4.749e+01  2.618e+00  1.341e+04 -18.137  &lt; 2e-16
age60                      -4.421e+01  2.619e+00  1.347e+04 -16.881  &lt; 2e-16
age65                      -4.389e+01  2.620e+00  1.352e+04 -16.752  &lt; 2e-16
age70                      -4.306e+01  2.621e+00  1.356e+04 -16.432  &lt; 2e-16
age75                      -4.250e+01  2.622e+00  1.361e+04 -16.211  &lt; 2e-16
age80                      -4.348e+01  2.622e+00  1.365e+04 -16.580  &lt; 2e-16
age85                      -4.388e+01  2.623e+00  1.366e+04 -16.728  &lt; 2e-16
age90                      -4.465e+01  2.624e+00  1.369e+04 -17.016  &lt; 2e-16
age95                      -4.537e+01  2.625e+00  1.369e+04 -17.286  &lt; 2e-16
age100                     -4.626e+01  2.625e+00  1.376e+04 -17.619  &lt; 2e-16
age105                     -4.713e+01  2.626e+00  1.377e+04 -17.947  &lt; 2e-16
age110                     -4.777e+01  2.627e+00  1.377e+04 -18.187  &lt; 2e-16
I(k1)                       3.091e-02  3.742e-01  1.969e+03   0.083 0.934192
I(k2)                       3.608e-03  3.968e-02  1.662e+03   0.091 0.927563
cohort                      8.767e-06  5.896e-04  1.380e+04   0.015 0.988136
age0:genderMale            -1.242e+00  2.948e+00  1.344e+04  -0.421 0.673455
age1:genderMale             3.062e-01  2.948e+00  1.391e+04   0.104 0.917270
age5:genderMale            -1.211e+01  2.948e+00  1.390e+04  -4.108 4.01e-05
age10:genderMale            4.591e-01  2.947e+00  1.387e+04   0.156 0.876214
age15:genderMale           -1.156e+01  2.947e+00  1.388e+04  -3.922 8.83e-05
age20:genderMale           -7.990e+00  2.946e+00  1.384e+04  -2.712 0.006705
age25:genderMale           -1.968e+01  2.946e+00  1.385e+04  -6.679 2.50e-11
age30:genderMale           -1.854e+01  2.946e+00  1.384e+04  -6.293 3.21e-10
age35:genderMale           -1.469e+01  2.945e+00  1.378e+04  -4.987 6.20e-07
age40:genderMale           -1.545e+01  2.945e+00  1.379e+04  -5.248 1.56e-07
age45:genderMale           -6.624e+00  2.216e+00  7.587e+03  -2.989 0.002810
age50:genderMale           -6.934e+00  2.219e+00  7.903e+03  -3.125 0.001784
age55:genderMale           -6.720e+00  2.221e+00  8.148e+03  -3.026 0.002490
age60:genderMale           -9.437e+00  2.223e+00  8.370e+03  -4.244 2.22e-05
age65:genderMale           -1.320e+01  2.225e+00  8.655e+03  -5.933 3.10e-09
age70:genderMale           -1.601e+01  2.228e+00  8.957e+03  -7.186 7.22e-13
age75:genderMale           -1.562e+01  2.230e+00  9.208e+03  -7.007 2.60e-12
age80:genderMale           -1.196e+01  2.232e+00  9.512e+03  -5.361 8.46e-08
age85:genderMale           -6.806e+00  2.233e+00  9.822e+03  -3.047 0.002316
age90:genderMale           -2.790e+00  2.235e+00  1.013e+04  -1.248 0.211973
age95:genderMale            1.915e-01  2.237e+00  1.044e+04   0.086 0.931782
age100:genderMale           2.226e+00  2.239e+00  1.069e+04   0.994 0.320033
age105:genderMale           3.165e+00  2.240e+00  1.101e+04   1.413 0.157705
age110:genderMale           3.344e+00  2.242e+00  1.131e+04   1.492 0.135756
age0:genderFemale:I(kc1)    1.407e+01  6.032e-01  8.594e+03  23.331  &lt; 2e-16
age1:genderFemale:I(kc1)    8.306e+00  6.033e-01  1.356e+04  13.768  &lt; 2e-16
age5:genderFemale:I(kc1)    9.379e+00  6.033e-01  1.315e+04  15.546  &lt; 2e-16
age10:genderFemale:I(kc1)   3.757e+00  6.033e-01  1.366e+04   6.228 4.87e-10
age15:genderFemale:I(kc1)  -6.064e-01  6.034e-01  1.341e+04  -1.005 0.314857
age20:genderFemale:I(kc1)  -3.266e+00  6.034e-01  1.377e+04  -5.414 6.28e-08
age25:genderFemale:I(kc1)  -8.197e-01  6.034e-01  1.343e+04  -1.359 0.174317
age30:genderFemale:I(kc1)  -2.001e+00  6.034e-01  1.379e+04  -3.316 0.000917
age35:genderFemale:I(kc1)  -1.867e+00  6.034e-01  1.389e+04  -3.094 0.001976
age40:genderFemale:I(kc1)  -1.971e+00  6.034e-01  1.337e+04  -3.266 0.001093
age45:genderFemale:I(kc1)  -9.177e-01  1.264e+00  4.994e+03  -0.726 0.467977
age50:genderFemale:I(kc1)   2.850e+00  1.266e+00  5.282e+03   2.251 0.024404
age55:genderFemale:I(kc1)   3.771e+00  1.268e+00  5.520e+03   2.974 0.002948
age60:genderFemale:I(kc1)   5.746e+00  1.270e+00  5.698e+03   4.526 6.12e-06
age65:genderFemale:I(kc1)   5.541e+00  1.271e+00  5.970e+03   4.359 1.33e-05
age70:genderFemale:I(kc1)   5.850e+00  1.273e+00  6.267e+03   4.596 4.39e-06
age75:genderFemale:I(kc1)   5.955e+00  1.274e+00  6.488e+03   4.673 3.03e-06
age80:genderFemale:I(kc1)   4.907e+00  1.276e+00  6.801e+03   3.846 0.000121
age85:genderFemale:I(kc1)   4.297e+00  1.277e+00  7.155e+03   3.364 0.000772
age90:genderFemale:I(kc1)   3.462e+00  1.278e+00  7.482e+03   2.708 0.006779
age95:genderFemale:I(kc1)   2.748e+00  1.280e+00  7.849e+03   2.147 0.031806
age100:genderFemale:I(kc1)  2.002e+00  1.281e+00  8.053e+03   1.563 0.118053
age105:genderFemale:I(kc1)  1.329e+00  1.282e+00  8.449e+03   1.036 0.300083
age110:genderFemale:I(kc1)  8.569e-01  1.283e+00  8.829e+03   0.668 0.504321
age0:genderMale:I(kc1)      1.361e+01  6.032e-01  1.367e+04  22.562  &lt; 2e-16
age1:genderMale:I(kc1)      8.627e+00  6.033e-01  1.357e+04  14.300  &lt; 2e-16
age5:genderMale:I(kc1)      6.017e+00  6.033e-01  1.337e+04   9.974  &lt; 2e-16
age10:genderMale:I(kc1)     3.596e+00  6.033e-01  1.366e+04   5.960 2.58e-09
age15:genderMale:I(kc1)    -4.102e+00  6.034e-01  1.342e+04  -6.799 1.10e-11
age20:genderMale:I(kc1)    -5.778e+00  6.034e-01  1.371e+04  -9.576  &lt; 2e-16
age25:genderMale:I(kc1)    -6.704e+00  6.034e-01  1.351e+04 -11.110  &lt; 2e-16
age30:genderMale:I(kc1)    -7.736e+00  6.034e-01  1.369e+04 -12.820  &lt; 2e-16
age35:genderMale:I(kc1)    -6.270e+00  6.034e-01  1.387e+04 -10.390  &lt; 2e-16
age40:genderMale:I(kc1)    -6.520e+00  6.034e-01  1.342e+04 -10.806  &lt; 2e-16
age45:genderMale:I(kc1)    -7.331e+00  1.264e+00  5.002e+03  -5.798 7.11e-09
age50:genderMale:I(kc1)    -3.531e+00  1.266e+00  5.296e+03  -2.789 0.005311
age55:genderMale:I(kc1)    -2.050e+00  1.268e+00  5.502e+03  -1.617 0.105939
age60:genderMale:I(kc1)    -1.769e+00  1.270e+00  5.705e+03  -1.393 0.163628
age65:genderMale:I(kc1)    -4.656e+00  1.271e+00  5.972e+03  -3.663 0.000251
age70:genderMale:I(kc1)    -6.506e+00  1.273e+00  6.267e+03  -5.112 3.29e-07
age75:genderMale:I(kc1)    -6.217e+00  1.274e+00  6.498e+03  -4.879 1.09e-06
age80:genderMale:I(kc1)    -4.385e+00  1.276e+00  6.825e+03  -3.437 0.000591
age85:genderMale:I(kc1)    -9.693e-01  1.277e+00  7.140e+03  -0.759 0.447914
age90:genderMale:I(kc1)     1.343e+00  1.278e+00  7.469e+03   1.050 0.293708
age95:genderMale:I(kc1)     2.978e+00  1.280e+00  7.861e+03   2.327 0.019998
age100:genderMale:I(kc1)    3.805e+00  1.281e+00  8.103e+03   2.971 0.002980
age105:genderMale:I(kc1)    3.842e+00  1.282e+00  8.435e+03   2.996 0.002740
age110:genderMale:I(kc1)    3.491e+00  1.283e+00  8.831e+03   2.720 0.006536
age0:genderFemale:I(kc2)    9.100e-01  4.283e-02  8.697e+03  21.248  &lt; 2e-16
age1:genderFemale:I(kc2)    4.599e-01  4.283e-02  1.290e+04  10.738  &lt; 2e-16
age5:genderFemale:I(kc2)    5.645e-01  4.284e-02  1.256e+04  13.177  &lt; 2e-16
age10:genderFemale:I(kc2)   1.859e-01  4.285e-02  1.304e+04   4.338 1.45e-05
age15:genderFemale:I(kc2)  -1.000e-01  4.286e-02  1.283e+04  -2.334 0.019606
age20:genderFemale:I(kc2)  -2.969e-01  4.287e-02  1.319e+04  -6.926 4.52e-12
age25:genderFemale:I(kc2)  -1.213e-01  4.287e-02  1.291e+04  -2.829 0.004675
age30:genderFemale:I(kc2)  -1.955e-01  4.288e-02  1.326e+04  -4.558 5.21e-06
age35:genderFemale:I(kc2)  -1.769e-01  4.289e-02  1.339e+04  -4.125 3.72e-05
age40:genderFemale:I(kc2)  -1.702e-01  4.290e-02  1.291e+04  -3.968 7.30e-05
age45:genderFemale:I(kc2)  -3.404e-01  2.483e-01  3.605e+03  -1.371 0.170454
age50:genderFemale:I(kc2)   3.492e-01  2.487e-01  3.812e+03   1.404 0.160397
age55:genderFemale:I(kc2)   4.717e-01  2.492e-01  3.992e+03   1.893 0.058445
age60:genderFemale:I(kc2)   8.151e-01  2.496e-01  4.140e+03   3.266 0.001101
age65:genderFemale:I(kc2)   7.642e-01  2.500e-01  4.347e+03   3.056 0.002253
age70:genderFemale:I(kc2)   8.421e-01  2.504e-01  4.576e+03   3.363 0.000778
age75:genderFemale:I(kc2)   8.850e-01  2.508e-01  4.761e+03   3.529 0.000422
age80:genderFemale:I(kc2)   7.141e-01  2.512e-01  5.008e+03   2.843 0.004489
age85:genderFemale:I(kc2)   6.193e-01  2.516e-01  5.287e+03   2.462 0.013847
age90:genderFemale:I(kc2)   4.825e-01  2.519e-01  5.556e+03   1.915 0.055484
age95:genderFemale:I(kc2)   3.738e-01  2.522e-01  5.858e+03   1.482 0.138414
age100:genderFemale:I(kc2)  2.650e-01  2.526e-01  6.062e+03   1.049 0.294215
age105:genderFemale:I(kc2)  1.696e-01  2.529e-01  6.399e+03   0.671 0.502485
age110:genderFemale:I(kc2)  1.033e-01  2.532e-01  6.733e+03   0.408 0.683153
age0:genderMale:I(kc2)      8.745e-01  4.283e-02  1.300e+04  20.419  &lt; 2e-16
age1:genderMale:I(kc2)      5.030e-01  4.283e-02  1.291e+04  11.744  &lt; 2e-16
age5:genderMale:I(kc2)      3.386e-01  4.284e-02  1.275e+04   7.905 2.90e-15
age10:genderMale:I(kc2)     1.625e-01  4.285e-02  1.303e+04   3.794 0.000149
age15:genderMale:I(kc2)    -3.451e-01  4.286e-02  1.284e+04  -8.052 8.85e-16
age20:genderMale:I(kc2)    -4.698e-01  4.287e-02  1.314e+04 -10.960  &lt; 2e-16
age25:genderMale:I(kc2)    -5.401e-01  4.287e-02  1.298e+04 -12.597  &lt; 2e-16
age30:genderMale:I(kc2)    -6.194e-01  4.288e-02  1.317e+04 -14.443  &lt; 2e-16
age35:genderMale:I(kc2)    -4.924e-01  4.289e-02  1.337e+04 -11.480  &lt; 2e-16
age40:genderMale:I(kc2)    -4.922e-01  4.290e-02  1.296e+04 -11.472  &lt; 2e-16
age45:genderMale:I(kc2)    -1.728e+00  2.483e-01  3.610e+03  -6.958 4.09e-12
age50:genderMale:I(kc2)    -9.759e-01  2.487e-01  3.820e+03  -3.923 8.89e-05
age55:genderMale:I(kc2)    -6.659e-01  2.492e-01  3.981e+03  -2.672 0.007568
age60:genderMale:I(kc2)    -5.706e-01  2.496e-01  4.144e+03  -2.286 0.022301
age65:genderMale:I(kc2)    -1.100e+00  2.500e-01  4.349e+03  -4.400 1.11e-05
age70:genderMale:I(kc2)    -1.449e+00  2.504e-01  4.575e+03  -5.786 7.67e-09
age75:genderMale:I(kc2)    -1.409e+00  2.508e-01  4.767e+03  -5.618 2.04e-08
age80:genderMale:I(kc2)    -1.035e+00  2.512e-01  5.023e+03  -4.119 3.87e-05
age85:genderMale:I(kc2)    -3.621e-01  2.516e-01  5.277e+03  -1.440 0.150037
age90:genderMale:I(kc2)     1.051e-01  2.519e-01  5.548e+03   0.417 0.676485
age95:genderMale:I(kc2)     4.462e-01  2.522e-01  5.866e+03   1.769 0.076980
age100:genderMale:I(kc2)    6.329e-01  2.526e-01  6.093e+03   2.506 0.012249
age105:genderMale:I(kc2)    6.665e-01  2.529e-01  6.389e+03   2.636 0.008416
age110:genderMale:I(kc2)    6.181e-01  2.532e-01  6.735e+03   2.441 0.014663
                              
(Intercept)                ***
age1                       ***
age5                       ***
age10                      ***
age15                      ***
age20                      ***
age25                      ***
age30                      ***
age35                      ***
age40                      ***
age45                      ***
age50                      ***
age55                      ***
age60                      ***
age65                      ***
age70                      ***
age75                      ***
age80                      ***
age85                      ***
age90                      ***
age95                      ***
age100                     ***
age105                     ***
age110                     ***
I(k1)                         
I(k2)                         
cohort                        
age0:genderMale               
age1:genderMale               
age5:genderMale            ***
age10:genderMale              
age15:genderMale           ***
age20:genderMale           ** 
age25:genderMale           ***
age30:genderMale           ***
age35:genderMale           ***
age40:genderMale           ***
age45:genderMale           ** 
age50:genderMale           ** 
age55:genderMale           ** 
age60:genderMale           ***
age65:genderMale           ***
age70:genderMale           ***
age75:genderMale           ***
age80:genderMale           ***
age85:genderMale           ** 
age90:genderMale              
age95:genderMale              
age100:genderMale             
age105:genderMale             
age110:genderMale             
age0:genderFemale:I(kc1)   ***
age1:genderFemale:I(kc1)   ***
age5:genderFemale:I(kc1)   ***
age10:genderFemale:I(kc1)  ***
age15:genderFemale:I(kc1)     
age20:genderFemale:I(kc1)  ***
age25:genderFemale:I(kc1)     
age30:genderFemale:I(kc1)  ***
age35:genderFemale:I(kc1)  ** 
age40:genderFemale:I(kc1)  ** 
age45:genderFemale:I(kc1)     
age50:genderFemale:I(kc1)  *  
age55:genderFemale:I(kc1)  ** 
age60:genderFemale:I(kc1)  ***
age65:genderFemale:I(kc1)  ***
age70:genderFemale:I(kc1)  ***
age75:genderFemale:I(kc1)  ***
age80:genderFemale:I(kc1)  ***
age85:genderFemale:I(kc1)  ***
age90:genderFemale:I(kc1)  ** 
age95:genderFemale:I(kc1)  *  
age100:genderFemale:I(kc1)    
age105:genderFemale:I(kc1)    
age110:genderFemale:I(kc1)    
age0:genderMale:I(kc1)     ***
age1:genderMale:I(kc1)     ***
age5:genderMale:I(kc1)     ***
age10:genderMale:I(kc1)    ***
age15:genderMale:I(kc1)    ***
age20:genderMale:I(kc1)    ***
age25:genderMale:I(kc1)    ***
age30:genderMale:I(kc1)    ***
age35:genderMale:I(kc1)    ***
age40:genderMale:I(kc1)    ***
age45:genderMale:I(kc1)    ***
age50:genderMale:I(kc1)    ** 
age55:genderMale:I(kc1)       
age60:genderMale:I(kc1)       
age65:genderMale:I(kc1)    ***
age70:genderMale:I(kc1)    ***
age75:genderMale:I(kc1)    ***
age80:genderMale:I(kc1)    ***
age85:genderMale:I(kc1)       
age90:genderMale:I(kc1)       
age95:genderMale:I(kc1)    *  
age100:genderMale:I(kc1)   ** 
age105:genderMale:I(kc1)   ** 
age110:genderMale:I(kc1)   ** 
age0:genderFemale:I(kc2)   ***
age1:genderFemale:I(kc2)   ***
age5:genderFemale:I(kc2)   ***
age10:genderFemale:I(kc2)  ***
age15:genderFemale:I(kc2)  *  
age20:genderFemale:I(kc2)  ***
age25:genderFemale:I(kc2)  ** 
age30:genderFemale:I(kc2)  ***
age35:genderFemale:I(kc2)  ***
age40:genderFemale:I(kc2)  ***
age45:genderFemale:I(kc2)     
age50:genderFemale:I(kc2)     
age55:genderFemale:I(kc2)  .  
age60:genderFemale:I(kc2)  ** 
age65:genderFemale:I(kc2)  ** 
age70:genderFemale:I(kc2)  ***
age75:genderFemale:I(kc2)  ***
age80:genderFemale:I(kc2)  ** 
age85:genderFemale:I(kc2)  *  
age90:genderFemale:I(kc2)  .  
age95:genderFemale:I(kc2)     
age100:genderFemale:I(kc2)    
age105:genderFemale:I(kc2)    
age110:genderFemale:I(kc2)    
age0:genderMale:I(kc2)     ***
age1:genderMale:I(kc2)     ***
age5:genderMale:I(kc2)     ***
age10:genderMale:I(kc2)    ***
age15:genderMale:I(kc2)    ***
age20:genderMale:I(kc2)    ***
age25:genderMale:I(kc2)    ***
age30:genderMale:I(kc2)    ***
age35:genderMale:I(kc2)    ***
age40:genderMale:I(kc2)    ***
age45:genderMale:I(kc2)    ***
age50:genderMale:I(kc2)    ***
age55:genderMale:I(kc2)    ** 
age60:genderMale:I(kc2)    *  
age65:genderMale:I(kc2)    ***
age70:genderMale:I(kc2)    ***
age75:genderMale:I(kc2)    ***
age80:genderMale:I(kc2)    ***
age85:genderMale:I(kc2)       
age90:genderMale:I(kc2)       
age95:genderMale:I(kc2)    .  
age100:genderMale:I(kc2)   *  
age105:genderMale:I(kc2)   ** 
age110:genderMale:I(kc2)   *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation matrix not shown by default, as p = 147 &gt; 12.
Use print(summary(m1), correlation=TRUE)  or
    vcov(summary(m1))        if you need it</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>optimizer (nloptwrap) convergence code: 0 (OK)
unable to evaluate scaled gradient
Model failed to converge: degenerate  Hessian with 5 negative eigenvalues</code></pre>
</div>
</div>
<section id="check-for-heteroskedasticity-and-assess-normality" class="level2">
<h2 class="anchored" data-anchor-id="check-for-heteroskedasticity-and-assess-normality">Check for Heteroskedasticity and Assess Normality</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fitted values and residuals to the ASDRs data frame</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>ASDRs<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">fitted</span>(m1)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>ASDRs<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">resid</span>(m1)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot to check for heteroskedasticity</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ASDRs<span class="sc">$</span>fit, ASDRs<span class="sc">$</span>res,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">main =</span> <span class="st">"LME Model for the Twelve Populations"</span>,</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">cex =</span> <span class="fl">0.5</span>, <span class="at">col =</span> <span class="st">"black"</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/hetero-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantile-quantile plot to assess normality assumption</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(ASDRs<span class="sc">$</span>res,</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>())</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 9737 9698</code></pre>
</div>
</div>
</section>
<section id="refine-the-model" class="level2">
<h2 class="anchored" data-anchor-id="refine-the-model">Refine the Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out data points with absolute residuals outside the range [-0.10, 0.10]</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>ASDRs2 <span class="ot">&lt;-</span> ASDRs[<span class="fu">abs</span>(ASDRs<span class="sc">$</span>res) <span class="sc">&lt;=</span> <span class="fl">0.10</span>, ]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a linear mixed-effects model (LME) to the refined dataset ASDRs2</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lmer</span>(y <span class="sc">~</span> age <span class="sc">+</span> gender<span class="sc">:</span>age <span class="sc">+</span> </span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>              gender<span class="sc">:</span>age<span class="sc">:</span>kc1 <span class="sc">+</span> gender<span class="sc">:</span>age<span class="sc">:</span>kc2 <span class="sc">+</span> </span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>              k1 <span class="sc">+</span> k2 <span class="sc">+</span> cohort <span class="sc">+</span> </span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>             (k1 <span class="sc">+</span> k2 <span class="sc">+</span> cohort <span class="sc">|</span> Country<span class="sc">:</span>gender<span class="sc">:</span>age),</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>           <span class="at">REML =</span> <span class="cn">TRUE</span>, <span class="at">data =</span> ASDRs2,</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a>           <span class="at">control =</span> <span class="fu">lmerControl</span>(<span class="at">optimizer =</span> <span class="st">"optimx"</span>, <span class="at">optCtrl =</span> <span class="fu">list</span>(<span class="at">method =</span> <span class="st">"nlminb"</span>))</span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="check-for-heteroskedasticity-and-assess-normality-refined-model" class="level2">
<h2 class="anchored" data-anchor-id="check-for-heteroskedasticity-and-assess-normality-refined-model">Check for Heteroskedasticity and Assess Normality (Refined Model)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add fitted values and residuals to the ASDRs2 data frame</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>ASDRs2<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">fitted</span>(m2)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>ASDRs2<span class="sc">$</span>res <span class="ot">&lt;-</span> <span class="fu">resid</span>(m2)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Scatter plot to check for heteroskedasticity</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(ASDRs2<span class="sc">$</span>fit, ASDRs2<span class="sc">$</span>res,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">xlab =</span> <span class="st">"Fitted Values"</span>, <span class="at">ylab =</span> <span class="st">"Residuals"</span>,</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">pch =</span> <span class="dv">1</span>, <span class="at">frame =</span> <span class="cn">FALSE</span>, <span class="at">cex =</span> <span class="fl">0.09</span>, <span class="at">col =</span> <span class="st">"black"</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/hetero ref-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Quantile-quantile plot to assess normality assumption</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqPlot</span>(ASDRs2<span class="sc">$</span>res,</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">ylab =</span> <span class="fu">deparse</span>(<span class="fu">substitute</span>())</span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3305 7665</code></pre>
</div>
</div>
</section>
<section id="backward-stepwise-selection" class="level2">
<h2 class="anchored" data-anchor-id="backward-stepwise-selection">Backward Stepwise Selection</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform backward stepwise selection on the LME model m2</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>(</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  step_lme2 <span class="ot">&lt;-</span> lmerTest<span class="sc">::</span><span class="fu">step</span>(m2)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
 327.28    2.61  893.45 </code></pre>
</div>
</div>
<p>Performing backward stepwise model selection with linear mixed-effects models can be computationally intensive for several reasons:</p>
<ol type="1">
<li><p><strong>Complexity of the Model:</strong> LME models, especially those with a large number of fixed and random effects, can be computationally demanding. Backward stepwise model selection involves fitting and comparing multiple models, and the complexity of the model can significantly impact the time it takes to fit each model.</p></li>
<li><p><strong>Number of Observations:</strong> If your dataset has a large number of observations, the time required for model fitting can increase. More data points may lead to longer computation times.</p></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract the final model from the stepwise selection</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">get_model</span>(step_lme2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the summary of the final selected model m3</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(m3))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear mixed model fit by REML. t-tests use Satterthwaite's method [
lmerModLmerTest]
Formula: y ~ age + k2 + cohort + (k2 + cohort | Country:gender:age) +  
    age:gender + age:gender:kc1 + age:gender:kc2
   Data: ASDRs2
Control: lmerControl(optimizer = "optimx", optCtrl = list(method = "nlminb"))

REML criterion at convergence: -39467.6

Scaled residuals: 
    Min      1Q  Median      3Q     Max 
-3.3602 -0.6248  0.0048  0.6190  3.1160 

Random effects:
 Groups             Name        Variance  Std.Dev.  Corr       
 Country:gender:age (Intercept) 4.408e-03 0.0663949            
                    k2          1.264e-03 0.0355529 -0.15      
                    cohort      1.476e-07 0.0003842 -0.03 -0.98
 Residual                       1.786e-03 0.0422659            
Number of obs: 12228, groups:  Country:gender:age, 288

Fixed effects:
                          Estimate Std. Error         df t value Pr(&gt;|t|)    
(Intercept)              4.987e+01  1.410e+00  1.124e+04  35.377  &lt; 2e-16 ***
age1                    -2.255e+01  2.022e+00  1.149e+04 -11.151  &lt; 2e-16 ***
age5                    -1.850e+01  2.147e+00  1.165e+04  -8.617  &lt; 2e-16 ***
age10                   -4.242e+01  2.169e+00  1.171e+04 -19.556  &lt; 2e-16 ***
age15                   -5.455e+01  2.048e+00  1.169e+04 -26.635  &lt; 2e-16 ***
age20                   -6.148e+01  2.029e+00  1.145e+04 -30.305  &lt; 2e-16 ***
age25                   -5.400e+01  1.929e+00  1.142e+04 -27.999  &lt; 2e-16 ***
age30                   -6.075e+01  1.913e+00  1.140e+04 -31.762  &lt; 2e-16 ***
age35                   -6.129e+01  1.899e+00  1.141e+04 -32.272  &lt; 2e-16 ***
age40                   -6.282e+01  1.843e+00  1.143e+04 -34.083  &lt; 2e-16 ***
age45                   -5.362e+01  1.630e+00  1.130e+04 -32.886  &lt; 2e-16 ***
age50                   -4.808e+01  1.623e+00  1.128e+04 -29.625  &lt; 2e-16 ***
age55                   -4.606e+01  1.623e+00  1.129e+04 -28.382  &lt; 2e-16 ***
age60                   -4.240e+01  1.633e+00  1.126e+04 -25.966  &lt; 2e-16 ***
age65                   -4.306e+01  1.625e+00  1.130e+04 -26.497  &lt; 2e-16 ***
age70                   -4.308e+01  1.617e+00  1.129e+04 -26.637  &lt; 2e-16 ***
age75                   -4.305e+01  1.619e+00  1.127e+04 -26.592  &lt; 2e-16 ***
age80                   -4.404e+01  1.619e+00  1.129e+04 -27.198  &lt; 2e-16 ***
age85                   -4.376e+01  1.617e+00  1.126e+04 -27.053  &lt; 2e-16 ***
age90                   -4.446e+01  1.618e+00  1.121e+04 -27.474  &lt; 2e-16 ***
age95                   -4.484e+01  1.617e+00  1.127e+04 -27.726  &lt; 2e-16 ***
age100                  -4.565e+01  1.617e+00  1.128e+04 -28.224  &lt; 2e-16 ***
age105                  -4.651e+01  1.618e+00  1.126e+04 -28.749  &lt; 2e-16 ***
age110                  -4.716e+01  1.618e+00  1.128e+04 -29.150  &lt; 2e-16 ***
k2                       6.051e-03  3.044e-03  5.934e+02   1.987 0.047339 *  
cohort                  -1.033e-03  2.334e-04  1.108e+04  -4.428 9.62e-06 ***
age0:genderMale         -6.683e-01  2.016e+00  1.151e+04  -0.332 0.740247    
age1:genderMale          9.203e-01  2.016e+00  1.155e+04   0.457 0.647997    
age5:genderMale         -1.279e+01  2.267e+00  1.172e+04  -5.642 1.72e-08 ***
age10:genderMale         3.220e+00  2.202e+00  1.176e+04   1.462 0.143689    
age15:genderMale        -1.235e+01  2.039e+00  1.166e+04  -6.057 1.43e-09 ***
age20:genderMale        -1.287e+01  2.013e+00  1.161e+04  -6.395 1.67e-10 ***
age25:genderMale        -2.007e+01  1.864e+00  1.153e+04 -10.768  &lt; 2e-16 ***
age30:genderMale        -1.628e+01  1.852e+00  1.153e+04  -8.788  &lt; 2e-16 ***
age35:genderMale        -1.189e+01  1.755e+00  1.149e+04  -6.773 1.33e-11 ***
age40:genderMale        -1.309e+01  1.736e+00  1.149e+04  -7.542 4.99e-14 ***
age45:genderMale        -5.245e+00  1.200e+00  1.016e+04  -4.370 1.25e-05 ***
age50:genderMale        -6.697e+00  1.190e+00  1.028e+04  -5.629 1.86e-08 ***
age55:genderMale        -6.570e+00  1.175e+00  1.016e+04  -5.590 2.33e-08 ***
age60:genderMale        -1.101e+01  1.194e+00  9.772e+03  -9.221  &lt; 2e-16 ***
age65:genderMale        -1.381e+01  1.181e+00  1.011e+04 -11.693  &lt; 2e-16 ***
age70:genderMale        -1.524e+01  1.165e+00  1.019e+04 -13.076  &lt; 2e-16 ***
age75:genderMale        -1.470e+01  1.160e+00  1.026e+04 -12.673  &lt; 2e-16 ***
age80:genderMale        -1.083e+01  1.160e+00  1.022e+04  -9.339  &lt; 2e-16 ***
age85:genderMale        -6.387e+00  1.158e+00  1.015e+04  -5.516 3.54e-08 ***
age90:genderMale        -2.444e+00  1.159e+00  9.989e+03  -2.109 0.034987 *  
age95:genderMale         7.980e-02  1.159e+00  1.009e+04   0.069 0.945114    
age100:genderMale        1.961e+00  1.160e+00  1.018e+04   1.691 0.090872 .  
age105:genderMale        3.035e+00  1.159e+00  1.018e+04   2.618 0.008858 ** 
age110:genderMale        3.210e+00  1.160e+00  1.028e+04   2.768 0.005646 ** 
age0:genderFemale:kc1    1.354e+01  3.951e-01  1.089e+04  34.272  &lt; 2e-16 ***
age1:genderFemale:kc1    7.705e+00  4.150e-01  1.174e+04  18.567  &lt; 2e-16 ***
age5:genderFemale:kc1    9.263e+00  4.578e-01  1.171e+04  20.233  &lt; 2e-16 ***
age10:genderFemale:kc1   2.956e+00  4.649e-01  1.175e+04   6.357 2.14e-10 ***
age15:genderFemale:kc1  -3.641e-01  4.167e-01  1.165e+04  -0.874 0.382241    
age20:genderFemale:kc1  -2.414e+00  4.231e-01  1.171e+04  -5.705 1.19e-08 ***
age25:genderFemale:kc1  -3.981e-01  3.797e-01  1.172e+04  -1.048 0.294461    
age30:genderFemale:kc1  -2.257e+00  3.733e-01  1.172e+04  -6.047 1.52e-09 ***
age35:genderFemale:kc1  -2.458e+00  3.670e-01  1.163e+04  -6.698 2.21e-11 ***
age40:genderFemale:kc1  -2.836e+00  3.420e-01  1.162e+04  -8.292  &lt; 2e-16 ***
age45:genderFemale:kc1  -7.456e-01  6.637e-01  9.161e+03  -1.123 0.261311    
age50:genderFemale:kc1   3.112e+00  6.532e-01  9.211e+03   4.764 1.92e-06 ***
age55:genderFemale:kc1   4.039e+00  6.549e-01  9.043e+03   6.167 7.24e-10 ***
age60:genderFemale:kc1   6.420e+00  6.732e-01  8.172e+03   9.537  &lt; 2e-16 ***
age65:genderFemale:kc1   5.397e+00  6.597e-01  8.901e+03   8.180 3.23e-16 ***
age70:genderFemale:kc1   4.978e+00  6.474e-01  9.184e+03   7.689 1.63e-14 ***
age75:genderFemale:kc1   4.677e+00  6.492e-01  9.140e+03   7.205 6.28e-13 ***
age80:genderFemale:kc1   3.665e+00  6.495e-01  9.254e+03   5.643 1.72e-08 ***
age85:genderFemale:kc1   3.579e+00  6.479e-01  9.166e+03   5.524 3.40e-08 ***
age90:genderFemale:kc1   2.804e+00  6.492e-01  8.952e+03   4.319 1.58e-05 ***
age95:genderFemale:kc1   2.365e+00  6.481e-01  9.204e+03   3.650 0.000264 ***
age100:genderFemale:kc1  1.692e+00  6.483e-01  9.281e+03   2.610 0.009062 ** 
age105:genderFemale:kc1  1.045e+00  6.485e-01  9.199e+03   1.611 0.107126    
age110:genderFemale:kc1  5.704e-01  6.488e-01  9.291e+03   0.879 0.379285    
age0:genderMale:kc1      1.324e+01  4.111e-01  1.172e+04  32.208  &lt; 2e-16 ***
age1:genderMale:kc1      8.040e+00  3.889e-01  1.160e+04  20.676  &lt; 2e-16 ***
age5:genderMale:kc1      5.546e+00  4.400e-01  1.166e+04  12.605  &lt; 2e-16 ***
age10:genderMale:kc1     3.492e+00  4.080e-01  1.171e+04   8.558  &lt; 2e-16 ***
age15:genderMale:kc1    -4.086e+00  3.882e-01  1.163e+04 -10.526  &lt; 2e-16 ***
age20:genderMale:kc1    -6.331e+00  3.893e-01  1.172e+04 -16.262  &lt; 2e-16 ***
age25:genderMale:kc1    -6.272e+00  3.734e-01  1.169e+04 -16.796  &lt; 2e-16 ***
age30:genderMale:kc1    -7.082e+00  3.706e-01  1.159e+04 -19.107  &lt; 2e-16 ***
age35:genderMale:kc1    -5.999e+00  3.368e-01  1.160e+04 -17.813  &lt; 2e-16 ***
age40:genderMale:kc1    -6.697e+00  3.529e-01  1.155e+04 -18.974  &lt; 2e-16 ***
age45:genderMale:kc1    -5.821e+00  6.733e-01  8.716e+03  -8.646  &lt; 2e-16 ***
age50:genderMale:kc1    -3.121e+00  6.726e-01  9.018e+03  -4.641 3.52e-06 ***
age55:genderMale:kc1    -1.701e+00  6.576e-01  9.117e+03  -2.586 0.009719 ** 
age60:genderMale:kc1    -2.348e+00  6.636e-01  9.138e+03  -3.539 0.000404 ***
age65:genderMale:kc1    -5.278e+00  6.607e-01  9.156e+03  -7.989 1.53e-15 ***
age70:genderMale:kc1    -6.669e+00  6.553e-01  9.121e+03 -10.177  &lt; 2e-16 ***
age75:genderMale:kc1    -6.645e+00  6.477e-01  9.327e+03 -10.259  &lt; 2e-16 ***
age80:genderMale:kc1    -4.718e+00  6.473e-01  9.158e+03  -7.289 3.38e-13 ***
age85:genderMale:kc1    -1.334e+00  6.476e-01  9.122e+03  -2.061 0.039371 *  
age90:genderMale:kc1     9.694e-01  6.478e-01  9.059e+03   1.496 0.134588    
age95:genderMale:kc1     2.502e+00  6.490e-01  8.997e+03   3.854 0.000117 ***
age100:genderMale:kc1    3.268e+00  6.496e-01  9.089e+03   5.032 4.95e-07 ***
age105:genderMale:kc1    3.436e+00  6.485e-01  9.191e+03   5.299 1.19e-07 ***
age110:genderMale:kc1    3.079e+00  6.488e-01  9.262e+03   4.745 2.11e-06 ***
age0:genderFemale:kc2    8.571e-01  2.808e-02  1.064e+04  30.523  &lt; 2e-16 ***
age1:genderFemale:kc2    4.254e-01  2.951e-02  1.162e+04  14.415  &lt; 2e-16 ***
age5:genderFemale:kc2    5.490e-01  3.221e-02  1.174e+04  17.044  &lt; 2e-16 ***
age10:genderFemale:kc2   1.348e-01  3.257e-02  1.173e+04   4.138 3.53e-05 ***
age15:genderFemale:kc2  -7.819e-02  2.901e-02  1.176e+04  -2.696 0.007038 ** 
age20:genderFemale:kc2  -2.261e-01  3.033e-02  1.116e+04  -7.456 9.55e-14 ***
age25:genderFemale:kc2  -8.835e-02  2.710e-02  1.150e+04  -3.260 0.001117 ** 
age30:genderFemale:kc2  -2.101e-01  2.668e-02  1.143e+04  -7.873 3.77e-15 ***
age35:genderFemale:kc2  -2.193e-01  2.610e-02  1.162e+04  -8.404  &lt; 2e-16 ***
age40:genderFemale:kc2  -2.330e-01  2.423e-02  1.173e+04  -9.618  &lt; 2e-16 ***
age45:genderFemale:kc2  -3.293e-01  1.297e-01  7.640e+03  -2.540 0.011114 *  
age50:genderFemale:kc2   3.964e-01  1.278e-01  7.674e+03   3.102 0.001928 ** 
age55:genderFemale:kc2   5.196e-01  1.283e-01  7.524e+03   4.050 5.17e-05 ***
age60:genderFemale:kc2   9.591e-01  1.324e-01  6.637e+03   7.244 4.83e-13 ***
age65:genderFemale:kc2   7.393e-01  1.294e-01  7.378e+03   5.713 1.15e-08 ***
age70:genderFemale:kc2   6.635e-01  1.269e-01  7.681e+03   5.229 1.75e-07 ***
age75:genderFemale:kc2   6.270e-01  1.272e-01  7.649e+03   4.928 8.47e-07 ***
age80:genderFemale:kc2   4.708e-01  1.273e-01  7.744e+03   3.699 0.000218 ***
age85:genderFemale:kc2   4.767e-01  1.270e-01  7.675e+03   3.753 0.000176 ***
age90:genderFemale:kc2   3.528e-01  1.273e-01  7.501e+03   2.771 0.005604 ** 
age95:genderFemale:kc2   3.000e-01  1.271e-01  7.711e+03   2.360 0.018290 *  
age100:genderFemale:kc2  2.071e-01  1.272e-01  7.774e+03   1.629 0.103378    
age105:genderFemale:kc2  1.178e-01  1.272e-01  7.710e+03   0.926 0.354511    
age110:genderFemale:kc2  5.115e-02  1.273e-01  7.786e+03   0.402 0.687793    
age0:genderMale:kc2      8.329e-01  2.907e-02  1.187e+04  28.653  &lt; 2e-16 ***
age1:genderMale:kc2      4.580e-01  2.743e-02  1.176e+04  16.699  &lt; 2e-16 ***
age5:genderMale:kc2      2.866e-01  3.085e-02  1.177e+04   9.292  &lt; 2e-16 ***
age10:genderMale:kc2     1.550e-01  2.888e-02  1.171e+04   5.367 8.17e-08 ***
age15:genderMale:kc2    -3.395e-01  2.742e-02  1.168e+04 -12.380  &lt; 2e-16 ***
age20:genderMale:kc2    -4.996e-01  2.767e-02  1.165e+04 -18.055  &lt; 2e-16 ***
age25:genderMale:kc2    -4.979e-01  2.680e-02  1.114e+04 -18.577  &lt; 2e-16 ***
age30:genderMale:kc2    -5.507e-01  2.629e-02  1.148e+04 -20.951  &lt; 2e-16 ***
age35:genderMale:kc2    -4.689e-01  2.385e-02  1.170e+04 -19.658  &lt; 2e-16 ***
age40:genderMale:kc2    -5.047e-01  2.501e-02  1.154e+04 -20.178  &lt; 2e-16 ***
age45:genderMale:kc2    -1.406e+00  1.318e-01  6.915e+03 -10.666  &lt; 2e-16 ***
age50:genderMale:kc2    -9.026e-01  1.316e-01  7.305e+03  -6.860 7.47e-12 ***
age55:genderMale:kc2    -6.075e-01  1.288e-01  7.557e+03  -4.718 2.42e-06 ***
age60:genderMale:kc2    -6.743e-01  1.299e-01  7.657e+03  -5.192 2.14e-07 ***
age65:genderMale:kc2    -1.219e+00  1.293e-01  7.643e+03  -9.424  &lt; 2e-16 ***
age70:genderMale:kc2    -1.470e+00  1.284e-01  7.605e+03 -11.454  &lt; 2e-16 ***
age75:genderMale:kc2    -1.477e+00  1.269e-01  7.777e+03 -11.636  &lt; 2e-16 ***
age80:genderMale:kc2    -1.095e+00  1.269e-01  7.667e+03  -8.625  &lt; 2e-16 ***
age85:genderMale:kc2    -4.303e-01  1.270e-01  7.642e+03  -3.388 0.000707 ***
age90:genderMale:kc2     3.439e-02  1.271e-01  7.596e+03   0.271 0.786675    
age95:genderMale:kc2     3.532e-01  1.273e-01  7.540e+03   2.774 0.005552 ** 
age100:genderMale:kc2    5.272e-01  1.274e-01  7.610e+03   4.137 3.56e-05 ***
age105:genderMale:kc2    5.872e-01  1.272e-01  7.705e+03   4.615 3.99e-06 ***
age110:genderMale:kc2    5.374e-01  1.273e-01  7.764e+03   4.222 2.45e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Correlation matrix not shown by default, as p = 146 &gt; 12.
Use print(summary(m3), correlation=TRUE)  or
    vcov(summary(m3))        if you need it</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>optimizer (optimx) convergence code: 1 (none)
boundary (singular) fit: see help('isSingular')</code></pre>
</div>
</div>
</section>
<section id="plot-backward-stepwise-selection-results" class="level2">
<h2 class="anchored" data-anchor-id="plot-backward-stepwise-selection-results">Plot Backward Stepwise Selection Results</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the results of backward stepwise selection</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(step_lme2) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/plot-step-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="random-effects-means" class="level2">
<h2 class="anchored" data-anchor-id="random-effects-means">Random Effects Means</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the mean of random effects for each level in the 'Country:gender:age' grouping</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>mean_random_effect_1 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[, <span class="dv">1</span>])</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mean_random_effect_2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[, <span class="dv">2</span>])</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>mean_random_effect_3 <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[, <span class="dv">3</span>])</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Output the results</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Random Effect Mean 1:"</span>, <span class="fu">round</span>(mean_random_effect_1, <span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Random Effect Mean 1: 0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Random Effect Mean 2:"</span>, <span class="fu">round</span>(mean_random_effect_2, <span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Random Effect Mean 2: 0"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Random Effect Mean 3:"</span>, <span class="fu">round</span>(mean_random_effect_3, <span class="dv">10</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Random Effect Mean 3: 0"</code></pre>
</div>
</div>
</section>
<section id="type-iii-analysis-of-variance-anova-for-significance-testing-final-model" class="level2">
<h2 class="anchored" data-anchor-id="type-iii-analysis-of-variance-anova-for-significance-testing-final-model">Type III Analysis of Variance (ANOVA) for Significance Testing (Final Model)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Perform Type III Analysis of Variance (ANOVA) on the LME model 'm3'</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>anova_results <span class="ot">&lt;-</span> <span class="fu">anova</span>(m3)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the ANOVA results</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(anova_results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Type III Analysis of Variance Table with Satterthwaite's method
                Sum Sq  Mean Sq NumDF   DenDF  F value    Pr(&gt;F)    
age             4.3445 0.188893    23 10710.7 105.7391 &lt; 2.2e-16 ***
k2              0.0071 0.007056     1   593.4   3.9497   0.04734 *  
cohort          0.0350 0.035019     1 11084.3  19.6031 9.622e-06 ***
age:gender      2.1127 0.088030    24 10698.1  49.2779 &lt; 2.2e-16 ***
age:gender:kc1 11.9112 0.248151    48  9999.3 138.9108 &lt; 2.2e-16 ***
age:gender:kc2 10.8334 0.225696    48  8825.7 126.3410 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Summary of Type III Analysis of Variance (ANOVA) Results: This table provides a comprehensive overview of the ANOVA analysis conducted to assess the significance of the fixed terms in the LME model. The p-values associated with each fixed term indicate the strength of evidence against the null hypothesis of no significant effect. P-values less than 2.2e-16 are denoted as ‘***,’ signifying extremely high statistical significance.</p>
</section>
<section id="histograms-of-random-effects-for-the-final-lme-model" class="level2">
<h2 class="anchored" data-anchor-id="histograms-of-random-effects-for-the-final-lme-model">Histograms of Random Effects for the Final LME Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set up a 1x3 plot layout</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>op <span class="ot">&lt;-</span> <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>))</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for random effect 'Intercept'</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[,<span class="dv">1</span>], <span class="at">breaks =</span> <span class="dv">12</span>,</span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">border =</span> <span class="st">"pink"</span>,</span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"Intercept"</span>,</span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="cn">NULL</span>)</span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for random effect 'I(kt2)'</span></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[,<span class="dv">2</span>], <span class="at">breaks =</span> <span class="dv">12</span>,</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">border =</span> <span class="st">"pink"</span>,</span>
<span id="cb43-13"><a href="#cb43-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"I(kt2)"</span>,</span>
<span id="cb43-14"><a href="#cb43-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="cn">NULL</span>)</span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot histogram for random effect 'cohort'</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">ranef</span>(m3)<span class="sc">$</span><span class="st">`</span><span class="at">Country:gender:age</span><span class="st">`</span>[,<span class="dv">3</span>], <span class="at">breaks =</span> <span class="dv">12</span>,</span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">border =</span> <span class="st">"pink"</span>,</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">"cohort"</span>,</span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="index_files/figure-html/hists-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Histograms of random effects</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Reset the plotting parameters to default</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(op)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="creation-of-new-dataset-for-the-lme-model-prediction" class="level1">
<h1>Creation of New Dataset for the LME Model Prediction</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Use random walk with drift to forecast future values of k</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>k_forecast <span class="ot">&lt;-</span> <span class="fu">rwf</span>(</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>  l,          <span class="co"># Time series data for forecasting</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">h =</span> <span class="dv">9</span>,      <span class="co"># Forecast horizon (next 9 time points)</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">drift =</span> <span class="cn">TRUE</span>,  <span class="co"># Include a drift term in the random walk</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>)  <span class="co"># Confidence levels for prediction intervals</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Repeat the mean forecast values 212 times</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>k1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(k_forecast<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>], <span class="at">times =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">24</span>)</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new vector 'k2' by squaring each element in 'k1'</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>k2 <span class="ot">&lt;-</span> k1<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list 'kcList' to store individual elements of kc</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a>kcList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through pairs of matrices in M, combining and calculating row means for specific columns</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>)) {</span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a>  matrix1 <span class="ot">&lt;-</span> M[[i]]</span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a>  matrix2 <span class="ot">&lt;-</span> M[[i <span class="sc">+</span> <span class="dv">1</span>]] <span class="co"># Adjust the index to access the second matrix</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract row means for the first 10 columns and append to 'kcList'</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a>  kcList <span class="ot">&lt;-</span> <span class="fu">c</span>(kcList, <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(matrix1[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>], matrix2[, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>])))</span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract row means for the last 14 columns and append to 'kcList'</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a>  kcList <span class="ot">&lt;-</span> <span class="fu">c</span>(kcList, <span class="fu">rowMeans</span>(<span class="fu">cbind</span>(matrix1[, <span class="dv">11</span><span class="sc">:</span><span class="dv">24</span>], matrix2[, <span class="dv">11</span><span class="sc">:</span><span class="dv">24</span>])))</span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all elements in kcList into a single vector 'kc0'</span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>kc0 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(kcList)</span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty vector 'ar' for storing forecasted values</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>ar <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through 12 subsets of kc0 to forecast future values using random walk with drift</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract a subset of kc0 for the current iteration</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>  subset_kc0 <span class="ot">&lt;-</span> kc0[((i <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">50</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(i <span class="sc">*</span> <span class="dv">50</span>)]</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Forecast the next 9 values using random walk with drift</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>  kc_forecast <span class="ot">&lt;-</span> <span class="fu">rwf</span>(subset_kc0, <span class="at">h =</span> <span class="dv">9</span>, <span class="at">drift =</span> <span class="cn">TRUE</span>, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">80</span>, <span class="dv">95</span>))</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract the mean values from the forecast and append to 'ar'</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>  ar <span class="ot">&lt;-</span> <span class="fu">append</span>(ar, kc_forecast<span class="sc">$</span>mean[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>])</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list 'kcList' for storing individual elements of kc</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>kcList <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the sequence of indices for iterating through 'ar'</span></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="fu">length</span>(ar), <span class="at">by =</span> <span class="dv">18</span>)</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the indices, combining and replicating blocks of 'ar'</span></span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> indices) {</span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract two consecutive blocks of 'ar'</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>  ar1 <span class="ot">&lt;-</span> ar[i<span class="sc">:</span>(i <span class="sc">+</span> <span class="dv">8</span>)]</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>  ar2 <span class="ot">&lt;-</span> ar[(i <span class="sc">+</span> <span class="dv">9</span>)<span class="sc">:</span>(i <span class="sc">+</span> <span class="dv">17</span>)]</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Replicate and combine the blocks according to the specified pattern</span></span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>  result1 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="fu">rep</span>(ar1, <span class="dv">10</span>), <span class="fu">rep</span>(ar2, <span class="dv">14</span>)), <span class="dv">2</span>)</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Append the result to 'kcList'</span></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>  kcList <span class="ot">&lt;-</span> <span class="fu">c</span>(kcList, result1)</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all elements in kcList into a single vector 'kc1'</span></span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a>kc1 <span class="ot">&lt;-</span> <span class="fu">unlist</span>(kcList)</span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new vector 'kc2' by squaring each element in 'kc1'</span></span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>kc2 <span class="ot">&lt;-</span> kc1<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for test set</span></span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>year <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">2011</span><span class="sc">:</span><span class="dv">2019</span>, <span class="at">times =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">24</span>)</span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>age_levels <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="dv">5</span>)))</span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>age <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fu">seq</span>(<span class="dv">5</span>, <span class="dv">110</span>, <span class="at">by =</span> <span class="dv">5</span>)), <span class="at">each =</span> <span class="dv">9</span>, <span class="at">times =</span> <span class="dv">12</span>)</span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>cohort <span class="ot">&lt;-</span> year <span class="sc">-</span> age</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize vectors for test set</span></span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>gender_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Female"</span>, <span class="st">"Male"</span>)</span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>gender <span class="ot">&lt;-</span> <span class="fu">rep</span>(gender_levels, <span class="at">each =</span> <span class="dv">24</span> <span class="sc">*</span> <span class="dv">9</span>, <span class="at">times =</span> <span class="dv">6</span>)</span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>Country_levels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"AUT"</span>, <span class="st">"BEL"</span>, <span class="st">"CHE"</span>, <span class="st">"CZE"</span>, <span class="st">"DNK"</span>, <span class="st">"SWE"</span>)</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>Country <span class="ot">&lt;-</span> <span class="fu">rep</span>(Country_levels, <span class="at">each =</span> <span class="dv">48</span> <span class="sc">*</span> <span class="dv">9</span>)</span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results into data frame for test set</span></span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a>newASDRs <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(k1, k2, kc1, kc2, cohort,<span class="at">y =</span> <span class="fu">as.vector</span>(MB0[<span class="dv">51</span><span class="sc">:</span><span class="dv">59</span>,]), age,</span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>                       gender, Country,<span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert factors to specified levels</span></span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>age <span class="ot">&lt;-</span> <span class="fu">factor</span>(newASDRs<span class="sc">$</span>age, <span class="at">levels =</span> age_levels)</span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>gender <span class="ot">&lt;-</span> <span class="fu">factor</span>(newASDRs<span class="sc">$</span>gender, <span class="at">levels =</span> gender_levels)</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>Country <span class="ot">&lt;-</span> <span class="fu">factor</span>(newASDRs<span class="sc">$</span>Country, <span class="at">levels =</span> Country_levels)</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predictions using the LME model</span></span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m3, <span class="at">newdata =</span> newASDRs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulating-parameter-uncertainty" class="level1">
<h1>Simulating Parameter Uncertainty</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Measure the time taken for the prediction interval calculation</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">system.time</span>({</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use the predictInterval function to obtain prediction intervals</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  PI <span class="ot">&lt;-</span> <span class="fu">predictInterval</span>(</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">merMod =</span> m3,                           <span class="co"># LME model</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">newdata =</span> newASDRs,                    <span class="co"># New data for prediction</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">level =</span> <span class="fl">0.95</span>,                          <span class="co"># Confidence level</span></span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.sims =</span> <span class="dv">10000</span>,                        <span class="co"># Number of simulations</span></span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">"mean"</span>,                         <span class="co"># Summary statistic (mean)</span></span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">"linear.prediction"</span>,            <span class="co"># Type of prediction</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">include.resid.var =</span> <span class="cn">TRUE</span>,              <span class="co"># Include residual variance</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">seed =</span> <span class="dv">1242</span>                            <span class="co"># Seed for reproducibility</span></span>
<span id="cb46-13"><a href="#cb46-13" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb46-14"><a href="#cb46-14" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   user  system elapsed 
   8.34    1.29   40.33 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and store the upper prediction limit in 'upr' column</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>upr <span class="ot">&lt;-</span> PI<span class="sc">$</span>upr</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract and store the lower prediction limit in 'lwr' column</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>newASDRs<span class="sc">$</span>lwr <span class="ot">&lt;-</span> PI<span class="sc">$</span>lwr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluating-forecast-accuracy-mean-squared-error-for-lme-model-predictions" class="level1">
<h1>Evaluating Forecast Accuracy: Mean Squared Error for LME Model Predictions</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute Mean Squared Error (MSE) for LME Model Forecasting</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty vector to store MSE values</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>MSE_test_lme <span class="ot">&lt;-</span> <span class="fu">c</span>()</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate through the 12 data sets of predictions</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (n <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) {</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract predicted values for the specific set (9 years, 24 observations each)</span></span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  lme_predictions <span class="ot">&lt;-</span> <span class="fu">matrix</span>(newASDRs<span class="sc">$</span>pred[(((n <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> (<span class="dv">9</span> <span class="sc">*</span> <span class="dv">24</span>)) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span>(n <span class="sc">*</span> (<span class="dv">9</span> <span class="sc">*</span> <span class="dv">24</span>))], <span class="dv">9</span>, <span class="dv">24</span>, <span class="at">byrow =</span> <span class="cn">FALSE</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Extract actual values for the corresponding set</span></span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>  actual_values <span class="ot">&lt;-</span> M0[[n]][<span class="dv">51</span><span class="sc">:</span><span class="dv">59</span>,]</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate the residuals (prediction errors)</span></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>  lme_errors <span class="ot">&lt;-</span> actual_values <span class="sc">-</span> lme_predictions</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Compute MSE for the set and append to the vector</span></span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>  MSE_test_lme_n <span class="ot">&lt;-</span> <span class="fu">sum</span>(lme_errors[, <span class="dv">1</span><span class="sc">:</span><span class="dv">24</span>]<span class="sc">^</span><span class="dv">2</span>) <span class="sc">/</span> (<span class="dv">24</span> <span class="sc">*</span> <span class="dv">9</span>)</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>  MSE_test_lme <span class="ot">&lt;-</span> <span class="fu">append</span>(MSE_test_lme, MSE_test_lme_n)</span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the vector of MSE values</span></span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a>MSE_test_lme</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 0.02354352 0.01912610 0.01296170 0.01704318 0.01819751 0.01851642
 [7] 0.01870164 0.01537664 0.03690819 0.02191939 0.02318679 0.01912486</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>